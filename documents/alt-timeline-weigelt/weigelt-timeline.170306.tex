\documentclass[10pt,landscape, onesided]{article}

\usepackage[
    paperheight=220mm
    , paperwidth=280mm
    , top=2cm
    , bottom=2cm
    , left=2cm
    , right=2cm
]{geometry}
\usepackage{etoolbox}
\usepackage[dvipsnames]{xcolor}
\usepackage{graphicx}
\usepackage{ifthen}
\usepackage{footnote} % to save and spew notes
\usepackage{calc}
\usepackage[hidelinks]{hyperref}
\def\UrlFont{\rmfamily\itshape} % roman font in urls
\usepackage{ragged2e}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{varwidth} % nodes size with adjusted width
\usetikzlibrary{calc, backgrounds}
\usepackage{polyglossia}
\setmainlanguage{german}
\setotherlanguage{arabic}
\usepackage{microtype}

\usepackage{fontspec}
\setmainfont[Numbers={OldStyle, Monospaced}]{Brill}
\setsansfont[Numbers=OldStyle, Scale=MatchLowercase]{Source Sans Pro ExtraLight}

% Constants
\def\startce{622}
\def\fince{1550}
\def\finceh{957}
% (CE − 622) × 33 ÷ 32

\frenchspacing

\tikzstyle{nodedefault} = [
    inner sep=1.5pt
    , outer sep=1pt
    , rotate = -90
    , fill=white
]

\tikzstyle{school} =  [
      yshift=.53ex
    , inner sep=0pt
    , outer sep=0pt
    , anchor = south
]


%Verticalal position of beginning of name
% \newlw
	
% Thickness of dynasty bar
\newlength\dynastyheight
\setlength\dynastyheight{.32cm}
\newlength\dynastyvshift
\setlength\dynastyvshift{.2cm}
% Vertical position of beginning of name
\newlength\personh
\setlength\personh{4.5cm}

\newlength\axistobottom
\setlength\axistobottom{8cm}

\newlength\dynwidth

% \grammarian[horizontal offset, or `adj`]{<name>}{<yod c.e.>}{<opus magnus>}{<school (B/Q)>}
\newcommand\person[5][0pt]{
    % Name and yod on top
    \ifthenelse{\equal{#1}{adj}}
    {
	\path (name.north west) 
	node [nodedefault, anchor=south west] (name) {#2};
    }
    {
        \path (#3,\personh) ++ (#1,0)
	    node [nodedefault, anchor=west] (name) {#2};
    }

    % Work below
    \path let \p1 = (name) in (\x1,-2\baselineskip)
       node [font=\itshape, rotate=-90, anchor=west] (work) {#4};

\begin{pgfonlayer}{background}
       % line to axis
       \draw [thin] (name.east) |- (#3,1.5) -- (#3,0) ;
\end{pgfonlayer}

       % school B/K
       \node at (name.west) [school, anchor=south] (school) {\MakeLowercase{\strut\textsc{#5}}};

       % year of death
       \path (name.west) ++ (0,4.2em) node [rotate=-90, anchor=west] (yod) {#3} ;

}

\newcommand\infobox[1]{%
  \draw[gray] let \p1 = (work) in node (infobox)
  [color=gray, anchor=north,draw=black, align=left, font=\scriptsize\itshape]
   at (\x1,-5) {\begin{varwidth}{2.5cm}\RaggedRight#1\end{varwidth}};
  \draw (infobox) -- (work.east);
}


% \dynasty{<color>}{<name>}{<startyear c.e.>}{<endyear c.e.>}{<graphical level (>0)>}
\newcommand\dynasty[6][]{%
\begin{pgfonlayer}{background}
    % bar
    \draw [
        yshift=\dynastyvshift+#6\dynastyheight
        , line width=\dynastyheight
        % , color=#2!30!gray % color
        , color=#2 % b/q
    ]
    (#4,0) [#1]-- (#5,0);
    % label
    \node [white, yshift=\dynastyvshift+#6\dynastyheight, font=\sffamily\footnotesize] 
    at ({#4+(#5-#4)/2},0) {#3};
\end{pgfonlayer}
}


% phases
% \phase{<name>}{<begin>}{<end>}
\newcommand{\phase}[3]{
    \draw [ultra thin, yshift=4.5em] (#2+2, \personh+2mm)
    -- (#2+2, \personh+4mm) --
    (#3-2, \personh+4mm)
    node [yshift=.5ex, midway, above, align=center, font=\itshape] {\strut#1}
    -- (#3-2, \personh+2mm);
}


\setlength\parindent{0pt}




\begin{document}
\thispagestyle{empty}


\begin{tikzpicture}[x=\textwidth/(\fince-\startce)]

     % Title
    \node at (1524, 8.5cm) [align=right, anchor=east]
        {\Large Entwicklung der arabischen Grammatiktradition\\[\smallskipamount]
    \normalsize\textnormal{Grammatiker und ausgewählte Werke}};
    
    \useasboundingbox (622,-4) -- (\fince,7.5); 
    % \renewcommand\baselinestretch{.8}

\node at (670,\personh) [school, align=right, anchor=south east] {\small Baṣra/Kūfa/Baġdād};
    \node at (670,\personh+3.5em-1.5pt) [inner sep=0pt, anchor=north east, align=right] {\small gestorben};

% Sort the list below with `sort n /{/`

% Phases
% Data collection, formation, theroeticlaelaboration, consolidiation, degeneration
% \phase{Pre-theoretical\\grammar}{650}{780}
    \phase{Vorläufer}{675}{770}
    \phase{Frühe Grammatiker}{770}{865} % p.8
    \phase{Systematisierung:\\Baṣra, Kūfa, Baġdād}{865}{1045}
    \phase{Kommentierung der Tradition, Ausbau der Darstellungsformen}{1045}{1525}


    % % \dynasty{Muḥammad}{622}{632}
  % \dynasty    {OliveGreen}   {Umayyaden}      {661}    {750}      {1}
  % %\dynasty   {blue}       {ar-Rāšhidun}   {632}    {661}      {1}
  % \dynasty    {red}   {Abbasiden}      {750}    {1258}     {1}
  % \dynasty    {black}   {Fatimiden (Ägypten)}      {909}    {1171}     {2}
  % \dynasty   {blue}   {Osmanen}      {1299}   {\fince}   {1}
  % \dynasty    {brown}   {\hspace{1em}Mamluken}       {1250}   {1517}     {2}
  % \dynasty    {RoyalPurple}   {Seldschuken (Irak, Iran)}       {1055}   {1258}     {3}

    % \dynasty{Muḥammad}{622}{632}
  \dynasty    {black!40}   {Umayyaden}      {661}    {750}      {1}
  % \dynasty   {black!20}       {ar-Rāšhidun}   {632}    {661}      {1}
  \dynasty    {black!20}   {Abbasiden}      {750}    {1258}     {1}
  \dynasty    {black!40}   {Fatimiden (Ägypten)}      {909}    {1171}     {2}
  \dynasty   {black!20}   {Osmanen}      {1299}   {\fince}   {1}
  \dynasty    {black!40}   {\hspace{1em}Mamluken}       {1250}   {1517}     {2}
  \dynasty    {black!20}   {Seldschuken (Irak, Iran)}       {1055}   {1258}     {3}

    % Special arrow for Ottomans
  \begin{pgfonlayer}{background}
      % bar
      \def\osmanencolor{black!20}
      \draw [line width=0pt, ultra thin,yshift=\dynastyvshift, 
          xshift=-.1pt, fill=\osmanencolor,color=\osmanencolor]
      (\fince,.5\dynastyheight) 
      -- ++ (.5\dynastyheight,.5\dynastyheight)
      -- ++ (-.5\dynastyheight,.5\dynastyheight) 
      -- cycle;
  \end{pgfonlayer}

% List of grammarians
  \person{ʾAbū l-ʾAswad ad-Duʾalī}{688}{*}{}
    \person{Naṣr b. ʿĀṣim al-Laiṯī}{703}{\textup{Koranüberlieferung} (qirāʾa)**}{}
    \person[-1ex]{Muqātil b. Sulaimān}{767}{\textup{Korankommentar (ohne Titel)**}}{}
    \person[adj]{al-Ḫalīl b. ʾAḥmad}{786}{Kitāb al-ʿAin}{B}
    \person[adj]{Sībawaih}{798}{al-Kitāb }{B} % p. 1. In Carter (2004:15) 796
    \person[adj]{al-Kisāʾī}{805}{*}{K} 
    \person[adj]{al-Farrāʾ}{822}{Maʿānī al-Qurʾān**}{K} % p.5
    \person[adj]{al-ʾAḫfaš al-ʾAusaṭ}{830}{*}{B} % p.5 835. EI 830
    % \person{al-Aṣmaʿī}{828}{}
    \person[-1ex]{al-Mubarrad}{898}{al-Muqtaḍab}{B}
    \person[adj]{Ṯaʿlab}{904}{Kitāb al-faṣīḥ}{K} % p.7
    \person{Ibn as-Sarrāǧ}{928}{ʾUṣūl an-naḥw}{B}
    % \infoboḫ{\textit{First expression of final canonical grammar.}}
    \person{az-Zaǧǧāǧī}{951}{al-ʾIḍāḥ fī ʿilal an-naḥw}{B\textnormal{ġ}} % p 11
    \person[-1.45ex]{as-Sirāfī}{979}{Šarḥ kitāb Sībawaih}{B} % p.14 in passing
    \person[adj]{ar-Rummānī}{994}{Šarḥ kitāb Sībawaih}{B\textnormal{ġ}} % p.14 in passing
    \person{Ibn Ǧinnī}{1002}{al-Ḫaṣāʾiṣ}{B\textnormal{ġ}}
    \person[adj]{Ibn Fāris}{1004}{aṣ-Ṣāḥib fī fiqh al-luġa}{}
    % \person[-2ex]{Ibn Bābašāḏ}{1077}{}
    \person{al-Ǧurǧānī}{1078}{Dalāʾil al-ʾiʿǧāz}{}
    % \infoboḫ{\textit{with Jurǧânî (d.1078) Arabic theory had reached its most sophisticated level} \citep{owens_foundations_1988}}
    \person{Ibn Maḍāʾ}{1196}{ar-Radd ʿalā an-nuḥāt}{} % p.58 1208. Versteegh (2013:208) 1196
    \person{al-ʾAnbārī}{1181}{Lumaʿ al-ʾadilla \textnormal{und} Nuzhat al-ʾalibbāʾ}{} % p.17
    \person{az-Zamaḫšarī}{1143}{al-Mufaṣṣal}{} % p. 118
    \person{Ibn Yaʿīš}{1245}{Šarḥ al-Mufaṣṣal}{}
    % \person{Ibn al-Ḥāǧib}{1249}{al-Kāfiya}
    % \infoboḫ{\textit{Apogee of pedagogical grammars} \citep{carter_grammatical_2006}}
    \person[adj]{Ibn ʿUṣfur}{1271}{al-Mumtiʿ  fī t-taṣrīf}{} % p.73
    \person[adj]{Ibn Mālik}{1274}{al-ʾAlfiyya}{}
    \person[adj]{al-ʾAstarābāḏī}{1287}{Šarḥ al-Kāfiya}{}
    \person{Ibn ʾĀǧurrūm}{1323}{al-ʾĀǧurrūmiyya}{} % IE
    \person[-.5ex]{Ibn Hišām}{1359}{Muġnī l-labīb}{} % p.14
    \person[adj]{Ibn ʿAqīl}{1367}{Šarḥ al-ʾAlfiyya}{} % p.14
    \person{al-ʾAšmūnī}{1494}{Šarḥ al-ʾAlfiyya}{} % p.14
    \person[adj]{as-Suyūṭī}{1505}{al-Muzhir}{} % IE
    



	% Axis
	\draw [->, very thick] (\startce,0) -- (\fince,0);

	% Axis ticks on 100s
	\foreach \x in {700,800,...,\fince} {
            \draw (\x, 0) -- (\x,-.2) node [yshift=1ex,outer sep=0pt,anchor=north] {\strut\x};
        }
70


	% % Axis ticks on 100s
    % \foreach \x in {0,100,...,$(\fince-622)*33/32$} {
            % \draw (\x, 0) -- (\x,-.2) node [yshift=1ex,outer sep=0pt,anchor=north] {\strut\x};
        % }

	% Axis tick on 25s
	% \foreach \x in {625,650,...,1525} 
	%     {\draw (\x, 0) -- (\x,-.1);}


	% Hijra
	\draw [very thick] (622, .5) -- (622, -.5) 
	  node [rotate=-90, anchor=west] {\textbf{\itshape al-Hiǧra}~(622)};


% Author information
      \node at (\startce, -\axistobottom) [anchor=south west]
          {
    \begin{minipage}[t]{9cm}
    \footnotesize
    Die Zeittafel enthält die im Buch genannten Gelehrten. Sie wurde zusammengestellt und typographisch gestaltet von Andreas Hallberg (Universität Göteborg, Schweden). Eine englische Fassung steht unter \textit{http://andreasmhallberg.github.io/\break timeline-of-arab-grammarians/} zur Verfügung.
    \end{minipage}
};


% Footnotes
\node at (\fince,-\axistobottom) [anchor=south east]
    {
\begin{tabular}[t]{r@{~}l}
          *&keine Werke erhalten\\
          {**} & keine grammatischen Werke erhalten\\
\end{tabular}
    };

\end{tikzpicture}

\end{document}

