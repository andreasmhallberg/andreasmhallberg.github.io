<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Typing Arabic in Vim</title>
  <style type="text/css">code{white-space: pre;}</style>
</head>
<body>
<div id="header">
<h1 class="title">Typing Arabic in Vim</h1>
</div>
<p><img src="typing-arabic-in-vim/ltr.tiff" alt="RTL display" /> <img src="typing-arabic-in-vim/rtl.tiff" alt="LTR display" /></p>
<h2 id="introduction">Introduction</h2>
<p>I often write documents that contain both Latin and Arabic script, often on the same line of text. Most often this is the case in exams and lecture notes. This can be challenging due to the complications of mixing of LTR (left-to-right) and RTL (right-to-left) script. These seems like an easy problem to solve for software developers, and it is, only not in software with graphical WYSIWYG interfaces, such as Word of OpenOffice. (I’m sure everyone who has tried writing mixed direction text in such software share my frustration with them, and I will therefore refrain from rants.) Since my shift to exclusively producing and editing text in plain text formats (.txt, .mkd, .csv, etc.) with the editor Vim, writing texts with mixed directionlity has become a lot easier. In this post I explain how.</p>
<p>When typing and editing on the computer, switching from Latin to Arabic script involves changing two basic things: changing the direction in which characters appear and changing the keyboard layout to produce a different character set. In Vim, each of these two changes is done indecently with the options <code>rightleft</code> for directionality and <code>keymap</code> for the keyboard layout. In the following I discuss each one of them in turn and how I use them.</p>
<h1 id="directionlaity-and-display">Directionlaity and display</h1>
<p>It is important to understand that when text is stored electronically is is represented by series of characters, including spaces and line breaks, order one after another in a long list. Think of this as the order they are typed. Some of these characters come with information that they are to be displayed LTR and others RTL, but it doesn’t effect the order in which they are stored in file. Thus if i type <code>hello</code> the letters are stored in that particular order, and it can be displayed as LTR (<code>hello</code>) or as RTL (‏<code>hello</code>‎) with the same ordering, only the direction is changed. If i type the letters</p>
<p>Vim lacks the capability of visually reordering specific letters according to the reading direction of that particular alphabet. All characters are displayed in a logical order, either LTR or RTL, as in the image in the introduction.</p>
<p>In the first case, Latin text will be displayed correctly and Arabic text reversed, in the second case Latin text will be displayed reversed but and Arabic text correctly.</p>
<p>You switch between the two ways of displaying text with <code>:set rightleft</code> and <code>:set norightleft</code>. I have this mapped to <code>&lt;leader&gt;a</code> to quickly switch back and forth. This mapping also switches to Arabic keyboard, as explained below. Thus, writing mixed Latin/Arabic documents becomes a process of quickly reorienting the entire text between the two modes exemplified above. The drawback of this method is that it is a bit disorienting. It is more difficult to navigate the using its visual properties on the screen since it changes so radically. The gains, as compared to WYSIWYG word processors, are however tremendous. Editing, marking, copying, and moving around in the Arabic text becomes completely painless. You can edit an change stuff as easily as you would any Latin-character text.</p>
<h1 id="keymap">Keymap</h1>
<p>Vim also comes with its keyboard layout for Arabic. You switch to it with <code>:set keymap=arabic</code>. (This is done independently of the writing/display direction discussed above. If you change the <code>keymap</code> option and not <code>rightleft</code> you will type Arabic characters, but from left to right.) Using Vim’s internal keymaps (see <code>:h mbyte-keymap</code>) is preferable to using the keyboard layout switching of the OS. Of you use the OS keyboard switch, normal mode commands no longer works, and all of Vim’s core functionality is lost. Vim’s internal keymap switching only applies to insert mode, search, and the like, while normal mode is unaffected, so that all your Vim muscle memory can do its thing.</p>
<p>Another advantage with Vim’s keymap is that it is very simple to edit. It consists of two columns, the first containing the input key and the second the Unicode character is is mapped to:</p>
<pre class="vim"><code>loadkeymap
q   &lt;char-0x0636&gt;   &quot; (1590)    - DAD
w   &lt;char-0x0635&gt;   &quot; (1589)    - SAD
e   &lt;char-0x062b&gt;   &quot; (1579)    - THEH
r   &lt;char-0x0642&gt;   &quot; (1602)    - QAF
[...]</code></pre>
<p>I am used to having the letter <em>dhaal</em> (ذ) on the §-key on the top right of the keyboard, as in PC-machines, but in Vim’s Arabic key mapping it is on the `-key next to the left shift. To change this I copied the original Arabic keymap file (I se MacVim so this file is locate in <code>/Applications/MacVim.app/Contents/Resources/vim/runtime/keymap/arabic_utf-8.vim</code>) to <code>~/.vim/keymap/</code> and changed its name to <code>arabic-pc_utf-8.vim</code>. The file name is arbitrary, accept that it must end with <code>_utf-8.vim</code>. In the new file I make the change change the key input that produces the letter <em>dhāl</em> from <code>\`` to</code>§` (line 54).</p>
<p>I can now call this new kemap with <code>:set keymap=arabic-pc</code> (the firs part of the file name for the keymap). You could also change the original file, but this method of making a copy and modifying it is better since you can store it separately and make it more easy accessible for different Vim installations. My slightly modified Arabic keymap file can for instance be found <a href="https://github.com/andreasmhallberg/dotfiles">here</a>.</p>
<p>If you only type some isolated Arabic words here and there, it easiest only to change the keymapping without changing the text direction. The Arabic words will look strange on the screen, ordered from left to right and connected as such. But they are still more or less readable, and for a few isolated words this is not too big of a deal.</p>
<h2 id="language-switching-command">Language switching command</h2>
<p>If you are often switching back and forth between English (or some other language that uses Latin script) and Arabic, it is a good idea to map to a key command a function that changes to RTL directionality and the Arabic keyboard layout, and then back. I have this set to <code>\a</code> for Arabic and <code>\e</code> for English using the code below (adapted from <a href="https://github.com/andreasmhallberg/dotfiles/blob/master/.vimrc">my vimrc</a>).</p>
<pre class="vim"><code>&quot; Switch to English - mapping
nmap &lt;Leader&gt;e :&lt;C-U&gt;call EngType()&lt;CR&gt;
&quot; Switch to Arabic - mapping
nmap &lt;Leader&gt;a :&lt;C-U&gt;call AraType()&lt;CR&gt;

&quot; Switch to English - function
function! EngType()
&quot; To switch back from Arabic
  set keymap= &quot; Restore default (US) keyboard layout
  set norightleft
endfunction

&quot; Switch to Arabic - function
function! AraType()
    set keymap=arabic-pc &quot;Modified keymap. File in .vim/keymap
    set rightleft
endfunction</code></pre>
</body>
</html>
